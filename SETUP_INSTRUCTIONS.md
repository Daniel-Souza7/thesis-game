# Setup Instructions

Follow these steps to get the Optimal Stopping Game up and running.

## Quick Start

### Step 1: Install Dependencies

**Backend (Python):**
```bash
cd backend
pip install -r requirements.txt
```

**Frontend (Node.js):**
```bash
cd frontend
npm install
```

### Step 2: Train the Models (IMPORTANT!)

This step is **required** before running the app. It generates the training data and trains the SRLSM models.

```bash
python backend/train_models.py
```

This will take approximately 2-5 minutes and will:
- Generate 50,000 training paths for each game
- Train SRLSM models on these paths
- Generate 500 test paths for gameplay
- Save everything to `backend/data/`

You should see output like:
```
==============================================================
Training UpAndOut Min Put (3 stocks)
==============================================================

Generating 50000 training paths...
Saved training paths to backend/data/paths/upandout_train.npz
Shape: (50000, 3, 11)

Training SRLSM model...
time path gen: 0.0001
Training complete!
  Option price: 8.1234
  Average exercise time: 0.6543
...

All models trained successfully!
```

### Step 3: Start the Backend Server

```bash
python backend/api.py
```

Server will start on `http://localhost:5000`

You should see:
```
Loading trained models and test paths...
  ✓ Loaded UpAndOut Min Put: 500 test paths
  ✓ Loaded DKO Lookback Put: 500 test paths

Loaded 2 games successfully!

Starting API server on http://localhost:5000
```

### Step 4: Start the Frontend (in a new terminal)

```bash
cd frontend
npm run dev
```

App will start on `http://localhost:3000`

Open your browser to `http://localhost:3000` and start playing!

## Verification

### Test Backend is Working

```bash
curl http://localhost:5000/api/health
```

Should return:
```json
{
  "status": "ok",
  "games_loaded": ["upandout", "dko"]
}
```

### Test Game Start

```bash
curl http://localhost:5000/api/game/start?product=upandout
```

Should return game data with paths and machine decisions.

## Troubleshooting

### "No module named 'torch'"

PyTorch is required. Install it:
```bash
pip install torch
```

For CPU-only (faster install):
```bash
pip install torch --index-url https://download.pytorch.org/whl/cpu
```

### "backend/data/ not found"

You need to run the training script first:
```bash
python backend/train_models.py
```

### Frontend won't connect to backend

1. Make sure backend is running on port 5000
2. Check `frontend/vite.config.js` proxy settings
3. Try accessing `http://localhost:5000/api/health` directly

### Training is too slow

For testing purposes, you can reduce the number of paths in `backend/train_models.py`:

```python
NB_TRAIN_PATHS = 5000  # Instead of 50000
NB_TEST_PATHS = 100    # Instead of 500
```

## Production Deployment

See `README.md` for Vercel deployment instructions.

### Important for Deployment

1. **Train models locally first** - Vercel has limited build time
2. **Commit trained models to git** - Include `backend/data/` in your repo
3. **Update API URL** in `frontend/src/App.jsx` for production

## File Structure After Setup

```
thesis-game/
├── backend/
│   ├── data/
│   │   ├── trained_models/
│   │   │   ├── upandout_minput.pkl       ← Generated by training
│   │   │   └── dko_lookback_put.pkl      ← Generated by training
│   │   └── paths/
│   │       ├── upandout_train.npz        ← Generated by training
│   │       ├── upandout_test.npz         ← Generated by training
│   │       ├── dko_train.npz             ← Generated by training
│   │       └── dko_test.npz              ← Generated by training
│   └── ...
├── frontend/
│   ├── node_modules/                     ← Generated by npm install
│   ├── dist/                             ← Generated by npm run build
│   └── ...
└── ...
```

## Next Steps

Once everything is running:

1. Play the game and test both products (UpAndOut and DKO)
2. Adjust game parameters in `backend/train_models.py` if needed
3. Customize the frontend styling in `frontend/src/styles/index.css`
4. Deploy to Vercel when ready

Enjoy the game!
